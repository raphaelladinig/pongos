#include "include/vga.h"

static const unsigned char font[27][8] = {
    {0x00, 0x00, 0x3C, 0x04, 0x3C, 0x44, 0x3E, 0x00}, // a
    {0x00, 0x40, 0x40, 0x5C, 0x62, 0x42, 0x7C, 0x00}, // b
    {0x00, 0x00, 0x3C, 0x40, 0x40, 0x40, 0x3C, 0x00}, // c
    {0x00, 0x02, 0x02, 0x3A, 0x46, 0x42, 0x3E, 0x00}, // d
    {0x00, 0x00, 0x3C, 0x42, 0x7E, 0x40, 0x3C, 0x00}, // e
    {0x00, 0x0C, 0x10, 0x3E, 0x10, 0x10, 0x10, 0x00}, // f
    {0x00, 0x00, 0x3E, 0x42, 0x42, 0x3E, 0x02, 0x3C}, // g
    {0x00, 0x40, 0x40, 0x5C, 0x62, 0x42, 0x42, 0x00}, // h
    {0x00, 0x10, 0x00, 0x30, 0x10, 0x10, 0x38, 0x00}, // i
    {0x00, 0x04, 0x00, 0x0C, 0x04, 0x44, 0x44, 0x38}, // j
    {0x00, 0x40, 0x40, 0x4C, 0x58, 0x70, 0x48, 0x00}, // k
    {0x00, 0x30, 0x10, 0x10, 0x10, 0x10, 0x38, 0x00}, // l
    {0x00, 0x00, 0x6C, 0x92, 0x92, 0x92, 0x92, 0x00}, // m
    {0x00, 0x00, 0x5C, 0x62, 0x42, 0x42, 0x42, 0x00}, // n
    {0x00, 0x00, 0x3C, 0x42, 0x42, 0x42, 0x3C, 0x00}, // o
    {0x00, 0x00, 0x5C, 0x62, 0x62, 0x5C, 0x40, 0x40}, // p
    {0x00, 0x00, 0x3A, 0x46, 0x46, 0x3A, 0x02, 0x02}, // q
    {0x00, 0x00, 0x5C, 0x62, 0x40, 0x40, 0x40, 0x00}, // r
    {0x00, 0x00, 0x3E, 0x40, 0x3C, 0x02, 0x7C, 0x00}, // s
    {0x00, 0x10, 0x10, 0x3E, 0x10, 0x10, 0x0C, 0x00}, // t
    {0x00, 0x00, 0x42, 0x42, 0x42, 0x46, 0x3A, 0x00}, // u
    {0x00, 0x00, 0x42, 0x42, 0x24, 0x24, 0x18, 0x00}, // v
    {0x00, 0x00, 0x92, 0x92, 0x92, 0x92, 0x6C, 0x00}, // w
    {0x00, 0x00, 0x42, 0x24, 0x18, 0x24, 0x42, 0x00}, // x
    {0x00, 0x00, 0x42, 0x42, 0x46, 0x3A, 0x02, 0x3C}, // y
    {0x00, 0x00, 0x7E, 0x04, 0x18, 0x20, 0x7E, 0x00}, // z
    {0x00, 0x10, 0x3C, 0x50, 0x3C, 0x12, 0x3C, 0x10}, // $
};

void draw_char(int x, int y, char c, unsigned char color) {
  const unsigned char *bitmap;
  unsigned char *video_memory = (unsigned char *)0xA0000;

  if (c == '$') {
    bitmap = font[26];
  } else if (c >= 'a' && c <= 'z') {
    bitmap = font[c - 'a'];
  } else {
    return; // Only draw characters in the font array
  }

  for (int i = 0; i < 8; i++) {
    for (int j = 0; j < 8; j++) {
      if (bitmap[i] & (1 << j)) {
        int pixel_position = (y + i) * VGA_WIDTH + (x + (7 - j));
        video_memory[pixel_position] = color;
      }
    }
  }
}

void draw_text(int x, int y, const char *text, unsigned char color) {
  while (*text) {
    draw_char(x, y, *text++, color);
    x += 8; // Move to the next character position
  }
}

void fill_screen(unsigned char color) {
  unsigned char *video_memory = (unsigned char *)0xA0000;
  for (int i = 0; i < VGA_WIDTH * VGA_HEIGHT; i++) {
    video_memory[i] = color;
  }
}

void draw_rectangle(struct rectangle *rectangle) {
  unsigned char *video_memory = (unsigned char *)0xA0000;

  for (int i = 0; i < rectangle->height; i++) {
    for (int j = 0; j < rectangle->width; j++) {
      int pixel_position = (rectangle->y + i) * VGA_WIDTH + (rectangle->x + j);
      video_memory[pixel_position] = rectangle->color;
    }
  }
}

void erase_rectangle(struct rectangle *rectangle) {
  draw_rectangle(&(struct rectangle){rectangle->x, rectangle->y,
                                     rectangle->height, rectangle->width, VGA_COLOR_BLACK});
}

void clear_screen() {
  unsigned char *video_memory = (unsigned char *)0xA0000;
  for (int i = 0; i < VGA_WIDTH * VGA_HEIGHT; i++) {
    video_memory[i] = VGA_COLOR_BLACK;
  }
}
